<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Minecraft Portal & Area Map Viewer</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #111;
      color: #ddd;
      max-width: 950px;
      margin: 20px auto;
      text-align: center;
    }
    #plot {
      width: 100%;
      height: 600px;
      margin-top: 20px;
    }
    input[type="file"] {
      margin-top: 20px;
      background: #222;
      color: #ddd;
      padding: 6px 12px;
      border-radius: 4px;
      border: 1px solid #444;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>Minecraft Portal & Area Map Viewer</h2>

<input type="file" id="jsonFileInput" accept=".json" />

<div id="plot"></div>

<script>
  const plotDiv = document.getElementById('plot');
  const fileInput = document.getElementById('jsonFileInput');

  function calcDtick(range) {
    const base = 16;
    const exp = Math.floor(Math.log2(range / base));
    return base * Math.pow(2, Math.max(exp,0));
  }

  function horizontalOverlap(r1, r2) {
    return !(r2.left > r1.right || r2.right < r1.left);
  }

  function updatePlot(portals, areas) {
    const data = [];
    const ps = portals.filter(p => p.enabled !== false); // treat undefined as enabled
    if (ps.length) {
      data.push({
        x: ps.map(p => p.x), y: ps.map(p => p.z),
        text: ps.map(p => `${p.label} (${p.x},${p.z})`),
        mode: 'markers+text', textposition: 'top center',
        marker: { size: 10, color: 'magenta' }, type: 'scatter', name: 'Portals'
      });
    }

    areas.filter(a => a.enabled !== false).forEach(a => {
      const xMin = Math.min(a.x1, a.x2), xMax = Math.max(a.x1, a.x2);
      const zMin = Math.min(a.z1, a.z2), zMax = Math.max(a.z1, a.z2);
      data.push({
        x: [xMin, xMax, xMax, xMin, xMin],
        y: [zMin, zMin, zMax, zMax, zMin],
        mode: 'lines', line: { color: 'red', width: 2 },
        showlegend: false, type: 'scatter'
      });
    });

    const areaLabelData = areas.filter
